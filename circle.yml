deployment:
  deploy_production:
    branch: production
    commands:
      - heroku maintenance:on --app supportroo
      - heroku scale worker=0 --app supportroo
      - git push git@heroku.com:supportroo.git $CIRCLE_SHA1:refs/heads/master
      - heroku run rake db:migrate --app supportroo
      - heroku scale worker=x --app supportroo
      - heroku restart --app supportroo
      - heroku maintenance:off --app supportroo
  deploy_staging:
    branch: staging
    commands:
      - heroku maintenance:on --app supportroo-staging
      - heroku scale worker=0 --app supportroo-staging
      - git push git@heroku.com:supportroo-staging.git $CIRCLE_SHA1:refs/heads/master
      - heroku run rake db:migrate --app supportroo-staging
      - heroku scale worker=x --app supportroo-staging
      - heroku restart --app supportroo-staging
      - heroku maintenance:off --app supportroo-staging